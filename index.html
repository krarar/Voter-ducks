<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <link rel="icon" type="image/png" href="https://firebasestorage.googleapis.com/v0/b/messageemeapp.appspot.com/o/icon-192.png?alt=media&token=8d29fc43-51ea-45f3-a41a-10b8f2e0d9cf">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‡Ø§ØªÙ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        /* Ù†ÙØ³ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£ØµÙ„ÙŠ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #8b5cf6;
            --accent: #ec4899;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1e293b;
            --dark-secondary: #334155;
            --light: #f8fafc;
            --light-secondary: #f1f5f9;
            --bg: #ffffff;
            --bg-secondary: #f8fafc;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --text: #1e293b;
            --text-light: #64748b;
            --text-muted: #94a3b8;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 16px;
            --sidebar-width: 280px;
            --header-height: 70px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg) 100%);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }
        .container {
            max-width: 400px;
            margin: 40px auto;
            background: var(--bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            padding: 32px 24px;
        }
        h2 {
            text-align: center;
            margin-bottom: 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2em;
            font-weight: 700;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-light);
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 18px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--light-secondary);
            font-size: 1em;
            transition: var(--transition);
        }
        input:focus, select:focus {
            border-color: var(--primary);
            outline: none;
        }
        button {
            width: 100%;
            padding: 12px;
            border-radius: var(--radius);
            border: none;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }
        button:hover {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .link {
            display: block;
            text-align: center;
            margin-top: 12px;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
        }
        .user-data {
            background: var(--light-secondary);
            border-radius: var(--radius-lg);
            padding: 28px 18px 18px 18px;
            margin-top: 28px;
            box-shadow: var(--shadow-md);
            max-width: 350px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
        }
        .flip-card {
            background: transparent;
            width: 220px;
            height: 140px;
            margin: 0 auto 18px auto;
            perspective: 1000px;
            cursor: pointer;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        .flip-card-front img, .flip-card-back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .flip-card-back {
            transform: rotateY(180deg);
        }
        .user-info {
            margin-top: 18px;
            text-align: right;
        }
        .user-info strong {
            color: var(--primary-dark);
            font-weight: 600;
        }
        .user-info span {
            color: var(--text);
            margin-right: 6px;
        }
        
        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            max-width: 350px;
            animation: slideIn 0.3s ease-out;
            font-weight: 500;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .notification.success {
            background: var(--success);
            color: white;
        }
        .notification.error {
            background: var(--danger);
            color: white;
        }
        .notification.warning {
            background: var(--warning);
            color: white;
        }
        .notification.info {
            background: var(--info);
            color: white;
        }
        
        /* Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Ù†Ø¸Ø§Ù… Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ */
        .error-log {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--dark);
            color: var(--light);
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            font-size: 0.9em;
            max-width: 300px;
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            cursor: pointer;
        }
        .error-details {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg);
            padding: 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            max-width: 500px;
            max-height: 70vh;
            overflow-y: auto;
            z-index: 10001;
            direction: ltr;
            text-align: left;
        }
        .error-details h3 {
            color: var(--danger);
            margin-bottom: 16px;
        }
        .error-details pre {
            background: var(--light-secondary);
            padding: 12px;
            border-radius: var(--radius-sm);
            overflow-x: auto;
            font-size: 0.85em;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
        }
        
        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ */
        .connection-status {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow);
        }
        .connection-status.online {
            background: var(--success);
            color: white;
        }
        .connection-status.offline {
            background: var(--danger);
            color: white;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
    <div id="splash" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:#fff;z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;">
        <img src="https://firebasestorage.googleapis.com/v0/b/messageemeapp.appspot.com/o/icon-192.png?alt=media&token=8d29fc43-51ea-45f3-a41a-10b8f2e0d9cf" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" style="width:180px;height:180px;border-radius:32px;box-shadow:0 4px 24px #6366f155;">
        <div style="margin-top:24px;color:var(--primary);font-size:1.1em;font-weight:600;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        <div class="loading" style="margin-top:16px;border-color:#e2e8f0;border-top-color:#6366f1;"></div>
    </div>
    
    <!-- Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ -->
    <div id="connectionStatus" class="connection-status" style="display:none;">
        <div class="status-dot"></div>
        <span id="statusText">Ù…ØªØµÙ„</span>
    </div>
    
    <!-- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="container" id="app" style="display:none;"></div>
    
    <script>
        // ====================================
        // Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
        // ====================================
        const ErrorLogger = {
            logs: [],
            maxLogs: 50,
            
            log(type, message, details = null) {
                const timestamp = new Date().toISOString();
                const error = {
                    type,
                    message,
                    details,
                    timestamp,
                    userAgent: navigator.userAgent,
                    url: window.location.href
                };
                
                this.logs.unshift(error);
                if (this.logs.length > this.maxLogs) {
                    this.logs.pop();
                }
                
                // Ø­ÙØ¸ ÙÙŠ localStorage
                try {
                    localStorage.setItem('errorLogs', JSON.stringify(this.logs));
                } catch (e) {
                    console.error('ÙØ´Ù„ Ø­ÙØ¸ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:', e);
                }
                
                // Ø·Ø¨Ø§Ø¹Ø© ÙÙŠ console
                console.error(`[${type}] ${message}`, details || '');
                
                // Ø¹Ø±Ø¶ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø®Ø·Ø£ Ø­Ø±Ø¬
                if (type === 'CRITICAL' || type === 'ERROR') {
                    this.showErrorToUser(message);
                }
            },
            
            showErrorToUser(message) {
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + message, 'error');
            },
            
            getLogs() {
                return this.logs;
            },
            
            clearLogs() {
                this.logs = [];
                localStorage.removeItem('errorLogs');
            },
            
            exportLogs() {
                const dataStr = JSON.stringify(this.logs, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const exportFileDefaultName = `error-logs-${Date.now()}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }
        };
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        try {
            const savedLogs = localStorage.getItem('errorLogs');
            if (savedLogs) {
                ErrorLogger.logs = JSON.parse(savedLogs);
            }
        } catch (e) {
            console.error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:', e);
        }
        
        // Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…Ø©
        window.addEventListener('error', (event) => {
            ErrorLogger.log('CRITICAL', 'Ø®Ø·Ø£ ÙÙŠ JavaScript', {
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                error: event.error ? event.error.stack : null
            });
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            ErrorLogger.log('ERROR', 'Promise Ù…Ø±ÙÙˆØ¶ ØºÙŠØ± Ù…Ø¹Ø§Ù„Ø¬', {
                reason: event.reason,
                promise: event.promise
            });
        });
        
        // ====================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        // ====================================
        function showNotification(message, type = 'info', duration = 5000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, duration);
        }
        
        // ====================================
        // Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        // ====================================
        const ConnectionMonitor = {
            isOnline: navigator.onLine,
            statusElement: null,
            
            init() {
                this.statusElement = document.getElementById('connectionStatus');
                this.updateStatus();
                
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateStatus();
                    showNotification('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'success');
                    ErrorLogger.log('INFO', 'ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateStatus();
                    showNotification('Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª - Ø³ÙŠØªÙ… Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„', 'warning');
                    ErrorLogger.log('WARNING', 'Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                });
            },
            
            updateStatus() {
                if (this.statusElement) {
                    this.statusElement.style.display = 'flex';
                    const statusText = document.getElementById('statusText');
                    
                    if (this.isOnline) {
                        this.statusElement.className = 'connection-status online';
                        statusText.textContent = 'Ù…ØªØµÙ„';
                    } else {
                        this.statusElement.className = 'connection-status offline';
                        statusText.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„';
                    }
                    
                    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¤Ø´Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
                    setTimeout(() => {
                        this.statusElement.style.display = 'none';
                    }, 3000);
                }
            }
        };
        
        // ====================================
        // Service Worker
        // ====================================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        ErrorLogger.log('INFO', 'Service Worker Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­', { scope: registration.scope });
                    })
                    .catch(error => {
                        ErrorLogger.log('ERROR', 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Service Worker', error);
                    });
            });
        }
        
        // ====================================
        // PWA Installation
        // ====================================
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            ErrorLogger.log('INFO', 'Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ«Ø¨ÙŠØª');
            
            const installBtn = document.createElement('button');
            installBtn.textContent = 'â¬‡ï¸ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ';
            installBtn.style.cssText = 'position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#6366f1;color:#fff;padding:12px 32px;border-radius:16px;font-size:1.1em;z-index:9999;box-shadow:0 4px 12px #6366f155;border:none;cursor:pointer;';
            
            installBtn.onclick = async function() {
                installBtn.style.display = 'none';
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                ErrorLogger.log('INFO', `Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª: ${outcome}`);
                deferredPrompt = null;
            };
            
            document.body.appendChild(installBtn);
        });
        
        // ====================================
        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‚Ø¶ÙŠØ©
        // ====================================
        const qadaList = [
            'Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠØ©',
            'Ø§Ù„Ø¯Ø¨Ù„Ø©',
            'Ø§Ù„Ø­Ù…Ø²Ø©',
            'Ø§Ù„ØºØ±Ø¨ÙŠ',
            'Ø§Ù„Ù‚Ø§Ø³Ù…',
            'Ø§Ù„Ø¬Ø±Ø¨ÙˆØ¹ÙŠØ©',
            'Ø§Ù„Ø¹Ù…Ø§Ø¯ÙŠØ©',
            'Ø£ÙƒÙŠØ§Ø³',
            'Ø£Ø¬Ø¨Ù„Ø©',
            'Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©',
            'Ø§Ù„Ù…Ø­Ø§ÙˆÙŠÙ„'
        ];
        
        // ====================================
        // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
        // ====================================
        const firebaseConfig = {
            apiKey: "AIzaSyDGpAHia_wEmrhnmYjrPf1n1TrAzwEMiAI",
            authDomain: "messageemeapp.firebaseapp.com",
            databaseURL: "https://messageemeapp-default-rtdb.firebaseio.com",
            projectId: "messageemeapp",
            storageBucket: "messageemeapp.appspot.com",
            messagingSenderId: "255034474844",
            appId: "1:255034474844:web:5e3b7a6bc4b2fb94cc4199",
            measurementId: "G-4QBEWRC583"
        };
        
        let db = null;
        let firebaseInitialized = false;
        
        try {
            if (typeof firebase === 'undefined') {
                throw new Error('Ù…ÙƒØªØ¨Ø© Firebase ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©');
            }
            
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                ErrorLogger.log('INFO', 'ØªÙ… ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ù†Ø¬Ø§Ø­');
            }
            
            db = firebase.database();
            firebaseInitialized = true;
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
            db.ref('.info/connected').on('value', (snapshot) => {
                if (snapshot.val() === true) {
                    ErrorLogger.log('INFO', 'Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Firebase');
                    showNotification('Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ“', 'success', 3000);
                } else {
                    ErrorLogger.log('WARNING', 'ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Firebase');
                }
            });
            
        } catch (error) {
            ErrorLogger.log('CRITICAL', 'ÙØ´Ù„ ØªÙ‡ÙŠØ¦Ø© Firebase', error);
            showNotification('ØªØ­Ø°ÙŠØ±: Ø³ÙŠØ¹Ù…Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„', 'warning', 5000);
        }
        
        // ====================================
        // Ø¯ÙˆØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        // ====================================
        
        // Ø­ÙØ¸ Ù…Ø³ØªØ®Ø¯Ù…
        async function saveUser(user) {
            try {
                ErrorLogger.log('INFO', 'Ø¨Ø¯Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', { phone: user.phone, name: user.fullName });
                
                // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹
                let users = JSON.parse(localStorage.getItem('users') || '[]');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹
                const existingIndex = users.findIndex(u => u.phone === user.phone);
                if (existingIndex !== -1) {
                    users[existingIndex] = user;
                    ErrorLogger.log('INFO', 'ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯');
                } else {
                    users.push(user);
                    ErrorLogger.log('INFO', 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯');
                }
                
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                ErrorLogger.log('INFO', 'ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
                
                // Ø­ÙØ¸ ÙÙŠ Firebase Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
                if (firebaseInitialized && db) {
                    try {
                        await db.ref('users/' + user.phone).set(user);
                        ErrorLogger.log('INFO', 'ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase Ø¨Ù†Ø¬Ø§Ø­', { phone: user.phone });
                        showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ“', 'success');
                    } catch (firebaseError) {
                        ErrorLogger.log('ERROR', 'ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase', firebaseError);
                        showNotification('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø· (ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©)', 'warning');
                    }
                } else {
                    ErrorLogger.log('WARNING', 'Firebase ØºÙŠØ± Ù…ØªØ§Ø­ - ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·');
                    showNotification('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ (ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª)', 'warning');
                }
                
                return true;
            } catch (error) {
                ErrorLogger.log('CRITICAL', 'ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!', 'error');
                return false;
            }
        }
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…
        function findUser(name, phone) {
            try {
                ErrorLogger.log('INFO', 'Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…', { name, phone });
                let users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.fullName === name && u.phone === phone);
                
                if (user) {
                    ErrorLogger.log('INFO', 'ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                } else {
                    ErrorLogger.log('WARNING', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                }
                
                return user;
            } catch (error) {
                ErrorLogger.log('ERROR', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', error);
                return null;
            }
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
        function getUserData(phone) {
            try {
                let users = JSON.parse(localStorage.getItem('users') || '[]');
                return users.find(u => u.phone === phone);
            } catch (error) {
                ErrorLogger.log('ERROR', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', error);
                return null;
            }
        }
        
        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
        async function syncFromFirebase() {
            if (!firebaseInitialized || !db) {
                ErrorLogger.log('WARNING', 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© - Firebase ØºÙŠØ± Ù…ØªØ§Ø­');
                return;
            }
            
            try {
                ErrorLogger.log('INFO', 'Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ù† Firebase');
                const snapshot = await db.ref('users').once('value');
                
                if (snapshot.exists()) {
                    const firebaseUsers = snapshot.val();
                    const usersArray = Object.values(firebaseUsers);
                    
                    localStorage.setItem('users', JSON.stringify(usersArray));
                    ErrorLogger.log('INFO', `ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ${usersArray.length} Ù…Ø³ØªØ®Ø¯Ù…`);
                    showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${usersArray.length} Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©`, 'success');
                } else {
                    ErrorLogger.log('INFO', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase');
                }
            } catch (error) {
                ErrorLogger.log('ERROR', 'ÙØ´Ù„Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ù† Firebase', error);
                showNotification('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©', 'error');
            }
        }
        
        // ====================================
        // ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        // ====================================
        
        // ÙˆØ§Ø¬Ù‡Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function renderLogin() {
            document.getElementById('app').innerHTML = `
                <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                <form id="loginForm">
                    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
                    <input type="text" name="fullName" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
                    
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" name="phone" required placeholder="07xxxxxxxxx" pattern="[0-9]{11}">
                    
                    <button type="submit" id="loginBtn">
                        <span>Ø¯Ø®ÙˆÙ„</span>
                    </button>
                </form>
                <span class="link" onclick="renderRegister()">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</span>
                
                <div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border);">
                    <button onclick="syncFromFirebase()" style="background:var(--info);font-size:0.95em;">
                        ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
                    </button>
                    <button onclick="showErrorLogs()" style="background:var(--dark);margin-top:12px;font-size:0.95em;">
                        ğŸ“‹ Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                    </button>
                </div>
            `;
            
            document.getElementById('loginForm').onsubmit = async function(e) {
                e.preventDefault();
                const btn = document.getElementById('loginBtn');
                const originalContent = btn.innerHTML;
                
                try {
                    btn.disabled = true;
                    btn.innerHTML = '<div class="loading"></div>';
                    
                    const fullName = this.fullName.value.trim();
                    const phone = this.phone.value.trim();
                    
                    ErrorLogger.log('INFO', 'Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', { fullName, phone });
                    
                    const user = findUser(fullName, phone);
                    
                    if (user) {
                        localStorage.setItem('currentUser', JSON.stringify(user));
                        ErrorLogger.log('INFO', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
                        showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! âœ“', 'success');
                        renderUserData(user);
                    } else {
                        ErrorLogger.log('WARNING', 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©');
                        showNotification('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!', 'error');
                        btn.disabled = false;
                        btn.innerHTML = originalContent;
                    }
                } catch (error) {
                    ErrorLogger.log('ERROR', 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
                    btn.disabled = false;
                    btn.innerHTML = originalContent;
                }
            };
        }
        
        // ÙˆØ§Ø¬Ù‡Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
        function renderRegister() {
            document.getElementById('app').innerHTML = `
                <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                <form id="registerForm">
                    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ <span style="color:var(--danger)">*</span></label>
                    <input type="text" name="fullName" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„">
                    
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <span style="color:var(--danger)">*</span></label>
                    <input type="tel" name="phone" required placeholder="07xxxxxxxxx" pattern="[0-9]{11}">
                    
                    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ <span style="color:var(--danger)">*</span></label>
                    <input type="date" name="birthDate" required>
                    
                    <label>Ø§Ù„Ù‚Ø¶Ø§Ø¡ <span style="color:var(--danger)">*</span></label>
                    <select name="district" required>
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø¶Ø§Ø¡ --</option>
                        ${qadaList.map(q => `<option value="${q}">${q}</option>`).join('')}
                    </select>
                    
                    <label>Ø§Ù„Ø¬Ù†Ø³ <span style="color:var(--danger)">*</span></label>
                    <select name="gender" required>
                        <option value="">-- Ø§Ø®ØªØ± --</option>
                        <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
                        <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
                    </select>
                    
                    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                    <input type="text" name="notes" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
                    
                    <label>Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© <span style="color:var(--danger)">*</span></label>
                    <input type="file" name="front" accept="image/*" required>
                    
                    <label>Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© <span style="color:var(--danger)">*</span></label>
                    <input type="file" name="back" accept="image/*" required>
                    
                    <button type="submit" id="registerBtn">
                        <span>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
                    </button>
                </form>
                <span class="link" onclick="renderLogin()">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
            `;
            
            document.getElementById('registerForm').onsubmit = async function(e) {
                e.preventDefault();
                const btn = document.getElementById('registerBtn');
                const originalContent = btn.innerHTML;
                
                try {
                    btn.disabled = true;
                    btn.innerHTML = '<div class="loading"></div> <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...</span>';
                    
                    const fullName = this.fullName.value.trim();
                    const phone = this.phone.value.trim();
                    const birthDate = this.birthDate.value;
                    const district = this.district.value;
                    const gender = this.gender.value;
                    const notes = this.notes.value.trim();
                    const frontFile = this.front.files[0];
                    const backFile = this.back.files[0];
                    
                    if (!frontFile || !backFile) {
                        throw new Error('ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                    }
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹
                    const existingUser = getUserData(phone);
                    if (existingUser) {
                        throw new Error('Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹!');
                    }
                    
                    ErrorLogger.log('INFO', 'Ø¨Ø¯Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯', { fullName, phone });
                    
                    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±
                    const frontImage = await readFileAsDataURL(frontFile);
                    const backImage = await readFileAsDataURL(backFile);
                    
                    const user = {
                        fullName,
                        phone,
                        birthDate,
                        district,
                        gender,
                        notes,
                        images: {
                            front: frontImage,
                            back: backImage
                        },
                        profileImg: null,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    const success = await saveUser(user);
                    
                    if (success) {
                        ErrorLogger.log('INFO', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                        showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! âœ“', 'success');
                        setTimeout(() => renderUserData(user), 500);
                    } else {
                        throw new Error('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                    }
                    
                } catch (error) {
                    ErrorLogger.log('ERROR', 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨', error);
                    showNotification(error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨', 'error');
                    btn.disabled = false;
                    btn.innerHTML = originalContent;
                }
            };
        }
        
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsDataURL(file);
            });
        }
        
        // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function renderUserData(user) {
            document.getElementById('app').innerHTML = `
                <h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>
                <div class="user-data">
                    <div style="text-align:center; margin-bottom:12px; position:relative;">
                        <label for="profileInput" style="cursor:pointer;display:inline-block;">
                            <img id="profileImg" src="${user.profileImg || (user.images?.front || '')}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" 
                                 style="width:90px;height:90px;border-radius:50%;object-fit:cover;border:3px dashed var(--primary);box-shadow:var(--shadow-md);">
                            ${!user.profileImg ? `<div style="position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);color:var(--primary);font-size:0.85em;font-weight:bold;background:#fff;padding:2px 10px;border-radius:12px;box-shadow:0 2px 8px #6366f133;">Ø£Ø¶Ù ØµÙˆØ±Ø© Ø§Ù†ØªØ®Ø§Ø¨Ùƒ Ù‡Ù†Ø§</div>` : ''}
                        </label>
                        <input type="file" id="profileInput" accept="image/*" capture="environment" style="display:none">
                    </div>
                    
                    <div class="flip-card" id="flipCard">
                        <div class="flip-card-inner">
                            <div class="flip-card-front">
                                <img src="${user.images?.front || ''}" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©">
                            </div>
                            <div class="flip-card-back">
                                <img src="${user.images?.back || ''}" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©">
                            </div>
                        </div>
                    </div>
                    
                    <div class="user-info">
                        <div><strong>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ:</strong> <span>${user.fullName}</span></div>
                        <div><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> <span>${user.phone}</span></div>
                        <div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</strong> <span>${user.birthDate}</span></div>
                        <div><strong>Ø§Ù„Ù‚Ø¶Ø§Ø¡:</strong> <span>${user.district}</span></div>
                        <div><strong>Ø§Ù„Ø¬Ù†Ø³:</strong> <span>${user.gender}</span></div>
                        ${user.notes ? `<div><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> <span>${user.notes}</span></div>` : ''}
                    </div>
                </div>
                
                <button onclick="logoutUser()" style="margin-top:24px;background:var(--danger);">
                    ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                </button>
                
                <button onclick="showErrorLogs()" style="margin-top:12px;background:var(--dark);font-size:0.95em;">
                    ğŸ“‹ Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                </button>
            `;
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØµÙØ­Ø©
            setTimeout(() => {
                // Ø­Ø¯Ø« Ù‚Ù„Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                const flipCard = document.getElementById('flipCard');
                if (flipCard) {
                    flipCard.addEventListener('click', function() {
                        flipCard.classList.toggle('flipped');
                    });
                }
                
                // Ø­Ø¯Ø« Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                const profileInput = document.getElementById('profileInput');
                const profileImg = document.getElementById('profileImg');
                
                if (profileInput && profileImg) {
                    profileInput.onchange = async function(e) {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        try {
                            ErrorLogger.log('INFO', 'Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
                            const imageData = await readFileAsDataURL(file);
                            
                            profileImg.src = imageData;
                            user.profileImg = imageData;
                            user.updatedAt = new Date().toISOString();
                            
                            // Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«
                            await saveUser(user);
                            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ âœ“', 'success');
                            
                        } catch (error) {
                            ErrorLogger.log('ERROR', 'Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©', error);
                            showNotification('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©', 'error');
                        }
                    };
                }
            }, 100);
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logoutUser() {
            try {
                ErrorLogger.log('INFO', 'ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                localStorage.removeItem('currentUser');
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'info');
                renderLogin();
            } catch (error) {
                ErrorLogger.log('ERROR', 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', error);
            }
        }
        
        // Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        function showErrorLogs() {
            const logs = ErrorLogger.getLogs();
            
            if (logs.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø© âœ“', 'success');
                return;
            }
            
            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            overlay.onclick = () => {
                document.body.removeChild(overlay);
                document.body.removeChild(errorDetails);
            };
            
            const errorDetails = document.createElement('div');
            errorDetails.className = 'error-details';
            errorDetails.innerHTML = `
                <h3 style="text-align:right;direction:rtl;">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ (${logs.length})</h3>
                <div style="margin-bottom:16px;display:flex;gap:8px;">
                    <button onclick="ErrorLogger.exportLogs()" style="flex:1;padding:8px;background:var(--info);color:white;border:none;border-radius:8px;cursor:pointer;">
                        ØªØµØ¯ÙŠØ±
                    </button>
                    <button onclick="ErrorLogger.clearLogs();location.reload();" style="flex:1;padding:8px;background:var(--danger);color:white;border:none;border-radius:8px;cursor:pointer;">
                        Ù…Ø³Ø­
                    </button>
                </div>
                <pre>${JSON.stringify(logs, null, 2)}</pre>
            `;
            
            document.body.appendChild(overlay);
            document.body.appendChild(errorDetails);
        }
        
        // ====================================
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ====================================
        
        window.addEventListener('load', async function() {
            try {
                // ØªÙ‡ÙŠØ¦Ø© Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø§ØªØµØ§Ù„
                ConnectionMonitor.init();
                
                ErrorLogger.log('INFO', 'Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
                
                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                setTimeout(function() {
                    document.getElementById('splash').style.display = 'none';
                    document.getElementById('app').style.display = 'block';
                }, 1800);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
                const currentUser = localStorage.getItem('currentUser');
                
                if (currentUser) {
                    const user = JSON.parse(currentUser);
                    ErrorLogger.log('INFO', 'Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯', { phone: user.phone });
                    renderUserData(user);
                } else {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ù† Firebase
                    if (firebaseInitialized && navigator.onLine) {
                        await syncFromFirebase();
                    }
                    renderLogin();
                }
                
                ErrorLogger.log('INFO', 'Ø§ÙƒØªÙ…Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
                
            } catch (error) {
                ErrorLogger.log('CRITICAL', 'Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', error);
                document.getElementById('splash').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                renderLogin();
            }
        });
        
    </script>
</body>
</html>
